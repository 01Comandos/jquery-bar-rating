(function(d){var b,a,c;a=typeof window!=="undefined"&&window!==null?window:global;c="ontouchstart" in a;a.BarRating=b=(function(){function e(){this.show=function(){var i=d(this.elem),k,h,j=this.options,g,f=c?"touchstart":"click";if(!i.data("barrating")){i.data("barrating",{currentRatingValue:i.val(),currentRatingText:d("option:selected",i).text(),originalRatingValue:i.val(),originalRatingText:d("option:selected",i).text()});k=d("<div />",{"class":"bar-rating"}).insertAfter(i);i.data("barrating").deselectable=(!i.find("option:first").val())?true:false;if(j.reverse){g="nextAll"}else{g="prevAll"}i.find("option").each(function(){var o,n,m,l;o=d(this).val();if(o){n=d(this).text();m=d("<a />",{href:"#","data-rating-value":o,"data-rating-text":n});l=d("<span />",{text:(j.showValues)?n:""});k.append(m.append(l))}});if(j.showSelectedRating){k.append(d("<div />",{text:"","class":"current-rating"}))}h=k.find("a");k.on("ratingchange",function(l,m,n){m=m?m:i.data("barrating").currentRatingValue;n=n?n:i.data("barrating").currentRatingText;i.find("option").attr("selected",false);i.find('option[value="'+m+'"]').attr("selected",true);if(j.showSelectedRating){d(this).find(".current-rating").text(n)}}).trigger("ratingchange");k.on("updaterating",function(l){d(this).find('a[data-rating-value="'+i.data("barrating").currentRatingValue+'"]').addClass("selected current")[g]().addClass("selected")}).trigger("updaterating");if(c){h.on("click",function(l){l.preventDefault()})}h.on(f,function(l){var n=d(this),m,o;l.preventDefault();h.removeClass("active selected");n.addClass("selected")[g]().addClass("selected");m=n.attr("data-rating-value");o=n.attr("data-rating-text");if(n.hasClass("current")&&i.data("barrating").deselectable){n.removeClass("selected current")[g]().removeClass("selected current");m="",o=""}else{h.removeClass("current");n.addClass("current")}i.data("barrating").currentRatingValue=m;i.data("barrating").currentRatingText=o;k.trigger("ratingchange");j.onSelect.call(this,i.data("barrating").currentRatingValue,i.data("barrating").currentRatingText);return false});if(!c){h.on({mouseenter:function(){var l=d(this);h.removeClass("active").removeClass("selected");l.addClass("active")[g]().addClass("active");k.trigger("ratingchange",[l.attr("data-rating-value"),l.attr("data-rating-text")])}});k.on({mouseleave:function(){h.removeClass("active");k.trigger("ratingchange").trigger("updaterating")}})}i.hide()}};this.clear=function(){var f=d(this.elem);var g=f.next(".bar-rating");if(g&&f.data("barrating")){g.find("a").removeClass("selected current");f.data("barrating").currentRatingValue=f.data("barrating").originalRatingValue;f.data("barrating").currentRatingText=f.data("barrating").originalRatingText;g.trigger("ratingchange").trigger("updaterating");this.options.onClear.call(this,f.data("barrating").currentRatingValue,f.data("barrating").currentRatingText)}};this.destroy=function(){var g=d(this.elem);var i=g.next(".bar-rating");if(i&&g.data("barrating")){var f=g.data("barrating").currentRatingValue;var h=g.data("barrating").currentRatingText;g.removeData("barrating");i.off().remove();g.show();this.options.onDestroy.call(this,f,h)}}}e.prototype.init=function(g,h){var f;f=this;f.elem=h;return f.options=d.extend({},d.fn.barrating.defaults,g)};return e})();d.fn.barrating=function(f,e){return this.each(function(){var g=new b();if(!d(this).is("select")){d.error("Sorry, this plugin only works with select fields.")}if(g.hasOwnProperty(f)){g.init(e,this);return g[f]()}else{if(typeof f==="object"||!f){e=f;g.init(e,this);return g.show()}else{d.error("Method "+f+" does not exist on jQuery.barrating")}}})};return d.fn.barrating.defaults={showValues:false,showSelectedRating:true,reverse:false,onSelect:function(e,f){},onClear:function(e,f){},onDestroy:function(e,f){}}})(jQuery);